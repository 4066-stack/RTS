<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Return to Sender Label Generator</title>
    <script src="https://cdn.jsdelivr.net/npm/jsbarcode@3.11.0/dist/JsBarcode.all.min.js"></script>
    <style>
        :root {
            --label-width: 4in;
            --label-height: 6in;
        }

        body {
            font-family: 'Arial', sans-serif;
            background-color: #f0f0f0;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
            margin: 0;
        }

        /* --- INPUT CONTROLS --- */
        .controls {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 20px;
            text-align: center;
            width: 100%;
            max-width: 400px;
        }

        .controls input {
            padding: 10px;
            font-size: 16px;
            width: 90%;
            margin-bottom: 5px;
            border: 1px solid #ccc;
            border-radius: 4px;
            box-sizing: border-box;
        }
        
        /* Style for the dropdown arrow in WebKit browsers */
        .controls input::-webkit-calendar-picker-indicator {
            opacity: 100;
        }

        .controls button {
            padding: 10px 20px;
            font-size: 16px;
            background-color: #007bff;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            width: 100%;
            margin-top: 10px;
        }

        .controls button:hover {
            background-color: #0056b3;
        }

        .limit-text {
            font-size: 11px;
            color: #666;
            margin-bottom: 15px;
            text-align: right;
            width: 90%;
            margin-left: auto;
            margin-right: auto;
        }

        /* --- LABEL DESIGN --- */
        .label-container {
            width: var(--label-width);
            height: var(--label-height);
            background: white;
            border: 1px solid black;
            box-sizing: border-box;
            display: flex;
            flex-direction: column;
            padding: 15px;
            position: relative;
        }

        .header {
            text-align: center;
            border-bottom: 4px solid black;
            padding-bottom: 10px;
            margin-bottom: 10px;
        }

        .header h1 {
            font-size: 32px;
            margin: 0;
            text-transform: uppercase;
            font-weight: 900;
            line-height: 1;
        }

        .timestamp {
            font-size: 12px;
            text-align: right;
            margin-top: 5px;
            font-family: 'Courier New', Courier, monospace;
        }

        .main-content {
            flex-grow: 1;
            display: flex;
            flex-direction: column;
            justify-content: flex-start;
            align-items: center;
            padding-top: 10px;
        }

        .tracking-text {
            font-size: 22px;
            letter-spacing: 2px;
            margin-bottom: 5px;
            font-family: 'Courier New', Courier, monospace;
            font-weight: bold;
            word-break: break-all;
        }

        #barcode {
            max-width: 95%;
            height: auto;
            margin-bottom: 20px;
        }

        /* Reason Section Styles */
        .reason-section {
            width: 100%;
            text-align: left;
            border-top: 2px dashed #000;
            padding-top: 10px;
            margin-top: 10px;
        }

        .reason-label {
            font-size: 14px;
            font-weight: bold;
            color: #555;
            display: block;
            margin-bottom: 5px;
        }

        .reason-display {
            font-size: 22px;
            font-weight: 900;
            text-transform: uppercase;
            word-wrap: break-word;
            line-height: 1.2;
        }

        .footer {
            text-align: center;
            font-size: 10px;
            border-top: 1px solid black;
            padding-top: 5px;
            margin-top: auto;
            min-height: 15px;
        }

        /* --- PRINT SETTINGS --- */
        @media print {
            @page {
                size: 4in 6in;
                margin: 0;
            }

            body {
                background: none;
                padding: 0;
                margin: 0;
                display: block;
            }

            .controls {
                display: none;
            }

            .label-container {
                border: none;
                width: 100%;
                height: 100vh;
                break-inside: avoid;
            }
        }
    </style>
</head>
<body>

    <div class="controls">
        <h2>Label Generator</h2>
        
        <label style="display:block; text-align:left; margin-bottom:5px; font-size:12px; font-weight:bold;">1. Tracking Number</label>
        <input type="text" id="trackingInput" maxlength="22" placeholder="Scan/Enter Tracking #" oninput="updateLabel()" autofocus>
        <div class="limit-text" id="trackingCount">0 / 22 characters</div>
        
        <label style="display:block; text-align:left; margin-bottom:5px; font-size:12px; font-weight:bold;">2. Return Reason</label>
        
        <input type="text" id="reasonInput" list="presetReasons" maxlength="120" placeholder="Select or Type Reason" oninput="updateLabel()">
        
        <datalist id="presetReasons">
            <option value="REFUSED">
            <option value="NO MAILBOX NUMBER / CUSTOMER NOT FOUND">
            <option value="DELIVERED TO WRONG ADDRESS">
            <option value="DAMAGED">
            <option value="UNCLAIMED">
            <option value="NO LONGER AT THIS ADDRESS">
        </datalist>

        <div class="limit-text" id="reasonCount">0 / 120 characters</div>
        
        <button onclick="window.print()">Print Label</button>
    </div>

    <div class="label-container">
        <div class="header">
            <h1>Return To Sender</h1>
            <div class="timestamp" id="dateDisplay"></div>
        </div>

        <div class="main-content">
            <div class="tracking-text" id="trackingText">
                
            </div>
            
            <svg id="barcode"></svg>

            <div class="reason-section">
                <span class="reason-label">REASON FOR RETURN:</span>
                <div class="reason-display" id="reasonDisplay"></div>
            </div>
        </div>

        <div class="footer">
            
        </div>
    </div>

    <script>
        // 1. Initialize Date and Time
        function updateTime() {
            const now = new Date();
            const dateString = now.toLocaleDateString() + ' ' + now.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
            document.getElementById('dateDisplay').textContent = dateString;
        }

        // 2. Master Update Logic
        function updateLabel() {
            // --- HANDLE TRACKING ---
            const trackingElem = document.getElementById('trackingInput');
            // Remove spaces & uppercase
            let cleanTracking = trackingElem.value.toUpperCase().replace(/\s/g, '');
            // Enforce hard limit 22
            if (cleanTracking.length > 22) cleanTracking = cleanTracking.slice(0, 22);
            // Reflect back to input if changed
            if(trackingElem.value !== cleanTracking) trackingElem.value = cleanTracking;

            // --- HANDLE REASON ---
            const reasonElem = document.getElementById('reasonInput');
            let cleanReason = reasonElem.value.toUpperCase();
            // Enforce hard limit 120
            if (cleanReason.length > 120) cleanReason = cleanReason.slice(0, 120);

            // --- UPDATE COUNTERS ---
            document.getElementById('trackingCount').textContent = `${cleanTracking.length} / 22 characters`;
            document.getElementById('reasonCount').textContent = `${cleanReason.length} / 120 characters`;

            // --- UPDATE LABEL DISPLAY ---
            const textDisplay = document.getElementById('trackingText');
            const reasonDisplay = document.getElementById('reasonDisplay');
            
            reasonDisplay.textContent = cleanReason;

            if (cleanTracking.length > 0) {
                textDisplay.textContent = cleanTracking;

                try {
                    JsBarcode("#barcode", cleanTracking, {
                        format: "CODE128",
                        lineColor: "#000",
                        width: 2, 
                        height: 70,
                        displayValue: false,
                        margin: 10
                    });
                    document.getElementById('barcode').style.display = 'block';
                } catch (e) {
                    console.log("Invalid barcode characters");
                }
            } else {
                textDisplay.innerHTML = "";
                document.getElementById('barcode').style.display = 'none';
            }
        }

        // Initialize
        updateTime();
        document.getElementById('barcode').style.display = 'none';

    </script>
</body>
</html>
